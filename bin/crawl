<?php

	require_once(TOOLKIT . '/class.gateway.php');
	require_once(EXTENSIONS . '/crawler/lib/class.session.php');

	Class Crawl extends ShellCommand{
		
		public function usage(){
			return "usage: crawl [URL] [BASE]
	Begins the crawl process. 
	
	Note: This command requires authentication

	options:
		[URL] - Link to website to crawl.
		[BASE] - Optional. Base URL. Allows the crawler to more accurately
				 determine how to follow relative links. If this is ommitted
				 the crawler will attempt to guess the base URL from [URL]

	examples:
		symphony -t 4141e465 crawler crawl http://mysite.com/
		symphony -t 4141e465 crawler crawl http://mysite.com/bananas/ http://mysite.com
\n";
		}
		
		public static function printCLIMessage($message, $include_break=true, $include_timestamp=true){
			printf(
				"%s%s%s", 
				($include_timestamp == true ? DateTimeObj::get('H:m:s') . ' > ' : NULL), 
				$message, 
				($include_break == true ? "\n" : NULL)
			);
		}
	
		public function run(array $args=NULL){
			
			if(!Shell::instance()->isLoggedIn()){
				throw new Exception('Valid authentication token must be supplied.');
			}
			
			elseif(empty($args)){
				print "Oops, no URL was specified. Did you forget it?\n";
				return;
			}
	
			$session = new Crawler\Session($args[0], Symphony::Database());
			$session->start();
			return;

		}
	}
	
	return 'Crawl';